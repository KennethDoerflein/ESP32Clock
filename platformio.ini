;==============================================================================
; PlatformIO Project Configuration File
;
; This file defines the project's build settings and dependencies.
; It uses a main [env] section for settings common to all environments,
; with specific configurations inheriting from it to minimize duplication.
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
;==============================================================================

[env]
;------------------------------------------------------------------------------
; COMMON CONFIGURATION
; These settings are shared between ALL environments.
;------------------------------------------------------------------------------

; --- PLATFORM & BOARD ---
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

; --- MEMORY CONFIGURATION (16MB Flash, 8MB Octal PSRAM) ---
board_upload.flash_size = 16MB
board_build.filesystem = littlefs
board_build.partitions = partitions.csv

; --- EXTRA SCRIPTS ---
extra_scripts = get_version.py

; --- COMMON BUILD FLAGS ---
build_flags =

    ; --- Common TFT_eSPI Library Configuration ---
    -DUSER_SETUP_LOADED         ; Critical: Tells TFT_eSPI to use settings defined here

    ; --- Common Pinout Configuration ---
    -DTFT_MOSI=13               ; SPI Master Out Slave In
    -DTFT_MISO=-1               ; SPI Master In Slave Out
    -DTFT_SCLK=14               ; SPI Clock
    -DTFT_CS=10                 ; TFT Chip Select
    -DTFT_DC=12                 ; TFT Data/Command
    -DTFT_RST=11                ; TFT Reset
    ; -DTFT_BL=6                  ; Backlight Control
    -DTOUCH_CS=-1               ; Touch Chip Select (disabled)
    
    ; --- Board-specific GPIO (moved from config.h) ---
    -DI2C_SDA=8                 ; I2C SDA pin for sensors
    -DI2C_SCL=9                 ; I2C SCL pin for sensors
    -DBUZZER_PIN=4              ; Active buzzer pin
    -DBUTTON_PIN=5              ; Stop / Snooze button pin

    ; --- Common SPI Bus Speed Configuration ---
    -DSPI_FREQUENCY=40000000    ; Main SPI frequency (40MHz)
    -DSPI_READ_FREQUENCY=20000000 ; Read frequency (20MHz)
    -DSPI_TOUCH_FREQUENCY=2500000 ; Touch controller frequency (2.5MHz)

    ; --- Common Font & Feature Selection ---
    -DUSE_HSPI_PORT             ; Use the HSPI hardware SPI port
    -DSMOOTH_FONT               ; Enable anti-aliased font rendering
    -DLOAD_GLCD                 ; Load classic GLCD font
    -DLOAD_FONT2                ; Load Font 2
    -DLOAD_FONT4                ; Load Font 4
    -DLOAD_FONT6                ; Load Font 6
    -DLOAD_FONT7                ; Load Font 7
    -DLOAD_FONT8                ; Load Font 8
    -DLOAD_GFXFF                ; Load Adafruit GFX Free Fonts

    ; --- Backlight Logic Level ---
    -DTFT_BACKLIGHT_ON=HIGH

    ; --- Backlight PWM Configuration ---
    -DTFT_PWM_CHANNEL=0      ; Use LEDC channel 0 for backlight
    -DTFT_PWM_FREQ=5000       ; Use 5kHz frequency
    -DTFT_PWM_RESOLUTION=8    ; Use 8-bit resolution

    ; --- C++ Standard Configuration ---
    -std=c++17
    -std=gnu++17

; --- UNDEFINE FLAGS ---
build_unflags =
  -std=gnu++11

  ; --- LIBRARY DEPENDENCIES for Physical Hardware ---
lib_deps =
    bodmer/TFT_eSPI@^2.5.43
    adafruit/RTClib@^2.1.4
    adafruit/Adafruit BME280 Library@^2.3.0
    esphome/ESPAsyncWebServer-esphome@^3.4.0
    esphome/AsyncTCP-esphome@^2.1.4
    bblanchon/ArduinoJson @ ^7.4.2

;==============================================================================
;== Environment for PHYSICAL HARDWARE (ESP32-S3 with 16MB/8MB)               ==
;==============================================================================
[env:esp32s3_n16r8]
; These settings override or add to the common [env] configuration.
board_build.arduino.memory_type = qio_opi

; --- HARDWARE-SPECIFIC BUILD FLAGS ---
build_flags =
    ${env.build_flags}          ; Inherit common flags from [env] section
    ; --- TFT Display Driver & Dimensions ---
    -DILI9488_DRIVER            ; Display driver for the physical hardware
    -DSCREEN_WIDTH=480
    -DSCREEN_HEIGHT=320
   ; --- PSRAM Support ---
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue

